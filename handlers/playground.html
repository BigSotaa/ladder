<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles.css" />
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <title>ladder | playground</title>
    <script src="/script.js" defer></script>
    <script type="importmap">
      {
        "imports": {
          "https://unpkg.com/lit-html@latest/directives/ref.js?module": "https://unpkg.com/lit-html@2.2.6/directives/ref.js?module"
        }
      }
    </script>
    <script type="module" src="https://unpkg.com/ninja-keys?module"></script>
    <script>
      const handleThemeChange = () => {
        let theme = localStorage.getItem("theme");
        if (theme === null) {
          localStorage.setItem("theme", "system");
          theme = "system";
        }
        if (
          theme === "dark" ||
          (theme === "system" &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
          const ninjaKeys = document.querySelector("ninja-keys");
          if (ninjaKeys !== null) ninjaKeys.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
          const ninjaKeys = document.querySelector("ninja-keys");
          if (ninjaKeys !== null) ninjaKeys.classList.remove("dark");
        }
      };
      handleThemeChange();
    </script>
  </head>

  <body
    class="antialiased bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-200"
  >
    <div class="flex flex-col h-screen">
      <div
        class="fixed top-0 inset-x-0 h-48 flex-col gap-4 max-w-3xl mx-4 lg:mx-auto pt-4"
      >
        <header class="flex flex-col gap-2">
          <div class="flex justify-between place-items-center">
            <div
              class="hover:drop-shadow-[0_0px_4px_rgba(122,167,209,.3)] ring-offset-white dark:ring-offset-slate-900 transition-colors duration-300 focus:outline-none focus:ring ring-offset-2"
            >
              <div class="flex">
                <a
                  href="/"
                  class="flex -ml-2 h-8 font-extrabold tracking-tight hover:no-underline focus:outline-none ring-offset-white dark:ring-offset-slate-900 focus:ring ring-offset-2"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    viewBox="0 0 512 512"
                    class="h-8 focus:outline-none focus:ring ring-offset-white dark:ring-offset-slate-900 ring-offset-2"
                  >
                    <path
                      fill="#7AA7D1"
                      d="M262.074 485.246C254.809 485.265 247.407 485.534 240.165 484.99L226.178 483.306C119.737 468.826 34.1354 383.43 25.3176 274.714C24.3655 262.975 23.5876 253.161 24.3295 241.148C31.4284 126.212 123.985 31.919 238.633 24.1259L250.022 23.8366C258.02 23.8001 266.212 23.491 274.183 24.1306C320.519 27.8489 366.348 45.9743 402.232 75.4548L416.996 88.2751C444.342 114.373 464.257 146.819 475.911 182.72L480.415 197.211C486.174 219.054 488.67 242.773 487.436 265.259L486.416 275.75C478.783 352.041 436.405 418.1 369.36 455.394L355.463 462.875C326.247 477.031 294.517 484.631 262.074 485.246ZM253.547 72.4475C161.905 73.0454 83.5901 144.289 73.0095 234.5C69.9101 260.926 74.7763 292.594 83.9003 317.156C104.53 372.691 153.9 416.616 211.281 430.903C226.663 434.733 242.223 436.307 258.044 436.227C353.394 435.507 430.296 361.835 438.445 267.978C439.794 252.442 438.591 236.759 435.59 221.5C419.554 139.955 353.067 79.4187 269.856 72.7052C264.479 72.2714 258.981 72.423 253.586 72.4127L253.547 72.4475Z"
                    />
                    <path
                      fill="#7AA7D1"
                      d="M153.196 310.121L133.153 285.021C140.83 283.798 148.978 285.092 156.741 284.353L156.637 277.725L124.406 278.002C123.298 277.325 122.856 276.187 122.058 275.193L116.089 267.862C110.469 260.975 103.827 254.843 98.6026 247.669C103.918 246.839 105.248 246.537 111.14 246.523L129.093 246.327C130.152 238.785 128.62 240.843 122.138 240.758C111.929 240.623 110.659 242.014 105.004 234.661L97.9953 225.654C94.8172 221.729 91.2219 218.104 88.2631 214.005C84.1351 208.286 90.1658 209.504 94.601 209.489L236.752 209.545C257.761 209.569 268.184 211.009 285.766 221.678L285.835 206.051C285.837 197.542 286.201 189.141 284.549 180.748C280.22 158.757 260.541 143.877 240.897 135.739C238.055 134.561 232.259 133.654 235.575 129.851C244.784 119.288 263.680 111.990 277.085 111.105C288.697 109.828 301.096 113.537 311.75 117.703C360.649 136.827 393.225 183.042 398.561 234.866C402.204 270.253 391.733 308.356 367.999 335.1C332.832 374.727 269.877 384.883 223.294 360.397C206.156 351.388 183.673 333.299 175.08 316.6C173.511 313.551 174.005 313.555 170.443 313.52L160.641 313.449C158.957 313.435 156.263 314.031 155.122 312.487L153.196 310.121Z"
                    />
                  </svg>
                </a>
                <a
                  href="/playground"
                  class="flex ml-1 h-8 font-extrabold tracking-tight hover:no-underline focus:outline-none focus:ring ring-offset-2 ring-offset-white dark:ring-offset"
                >
                  <span
                    class="text-3xl mr-1 text-[#7AA7D1] leading-8 align-middle"
                    >ladder | playground</span
                  >
                </a>
              </div>
            </div>

            <div class="flex justify-center z-10">
              <div class="relative" id="dropdown">
                <button
                  aria-expanded="closed"
                  onclick="toggleDropdown()"
                  type="button"
                  class="inline-flex items-center justify-center whitespace-nowrap rounded-full h-12 px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-400 ring-offset-white dark:ring-offset transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-white dark:bg-slate-900 hover:bg-slate-200 dark:hover:bg-slate-700 hover:text-slate-500 dark:hover:text-slate-200"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-5 w-5"
                  >
                    <path
                      d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
                    />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                </button>

                <div
                  id="dropdown_panel"
                  class="hidden absolute right-0 mt-2 w-52 rounded-md bg-white dark:bg-slate-900 shadow-md border border-slate-400 dark:border-slate-700"
                >
                  <div
                    class="flex flex-col gap-2 w-full first-of-type:rounded-t-md last-of-type:rounded-b-md px-4 py-2.5 text-left text-sm"
                  >
                    Appearance
                    <div class="grid grid-cols-4 gap-2">
                      <div>
                        <input
                          type="radio"
                          name="theme"
                          id="light"
                          value="light"
                          class="peer hidden"
                        />
                        <label
                          for="light"
                          tabindex="0"
                          title="Light"
                          class="flex items-end justify-center h-10 w-10 cursor-pointer select-none rounded-md p-2 text-sm text-slate-600 dark:text-slate-200 text-center hover:bg-slate-200 dark:hover:bg-slate-700 peer-checked:bg-slate-200 dark:peer-checked:bg-slate-700"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="h-5 w-5"
                          >
                            <circle cx="12" cy="12" r="4" />
                            <path d="M12 2v2" />
                            <path d="M12 20v2" />
                            <path d="m4.93 4.93 1.41 1.41" />
                            <path d="m17.66 17.66 1.41 1.41" />
                            <path d="M2 12h2" />
                            <path d="M20 12h2" />
                            <path d="m6.34 17.66-1.41 1.41" />
                            <path d="m19.07 4.93-1.41 1.41" />
                          </svg>
                        </label>
                      </div>
                      <div>
                        <input
                          type="radio"
                          name="theme"
                          id="dark"
                          value="dark"
                          class="peer hidden"
                        />
                        <label
                          for="dark"
                          tabindex="0"
                          title="Dark"
                          class="flex items-end justify-center h-10 w-10 cursor-pointer select-none rounded-md p-2 text-base text-slate-600 dark:text-slate-200 text-center hover:bg-slate-200 dark:hover:bg-slate-700 peer-checked:bg-slate-200 dark:peer-checked:bg-slate-700"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="h-5 w-5"
                          >
                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                          </svg>
                        </label>
                      </div>
                      <div>
                        <input
                          type="radio"
                          name="theme"
                          id="system"
                          value="system"
                          class="peer hidden"
                          checked
                        />
                        <label
                          for="system"
                          tabindex="0"
                          title="System preference"
                          class="flex items-end justify-center h-10 w-10 cursor-pointer select-none rounded-md p-2 text-lg text-slate-600 dark:text-slate-200 text-center hover:bg-slate-200 dark:hover:bg-slate-700 peer-checked:bg-slate-200 dark:peer-checked:bg-slate-700"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="h-5 w-5"
                          >
                            <path d="M12 8a2.83 2.83 0 0 0 4 4 4 4 0 1 1-4-4" />
                            <path d="M12 2v2" />
                            <path d="M12 20v2" />
                            <path d="m4.9 4.9 1.4 1.4" />
                            <path d="m17.7 17.7 1.4 1.4" />
                            <path d="M2 12h2" />
                            <path d="M20 12h2" />
                            <path d="m6.3 17.7-1.4 1.4" />
                            <path d="m19.1 4.9-1.4 1.4" />
                          </svg>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <form id="inputForm" method="get" class="flex flex-col gap-2 mx-4">
            <div class="flex gap-6">
              <div class="flex-1 relative">
                <input
                  type="url"
                  id="inputField"
                  placeholder="Enter URL"
                  name="inputField"
                  class="w-full text-sm leading-6 text-slate-400 rounded-md ring-1 ring-slate-900/10 shadow-sm py-1.5 pl-2 pr-3 hover:ring-slate-300 dark:bg-slate-800 dark:highlight-white/5 dark:hover:bg-slate-700"
                  autocomplete="off"
                  autofocus
                  required
                />
                <button
                  id="clearButton"
                  type="reset"
                  aria-label="Clear Search"
                  title="Clear Search"
                  class="hidden absolute inset-y-0 right-0 items-center pr-2 text-slate-600 dark:text-slate-400 hover:text-slate-400 hover:dark:text-slate-300"
                  tabindex="-1"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-4 w-4"
                  >
                    <path d="M18 6 6 18" />
                    <path d="m6 6 12 12" />
                  </svg>
                </button>
              </div>
              <button
                id="btnNinja"
                type="button"
                class="inline-flex items-center justify-center h-8 px-8 my-auto whitespace-nowrap rounded-xl text-sm font-medium text-slate-900 dark:text-slate-200 ring-offset-white dark:ring-offset-slate-900 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-white dark:bg-slate-900 hover:bg-slate-200/90 dark:hover:bg-slate-800/90 border hover:bg-slate-200 dark:hover:bg-slate-500"
              >
                Press &nbsp;<span id="ninjaKey">⌘</span>&nbsp; + K to Apply
                Modifiers
              </button>
            </div>
          </form>
          <div class="mt-4 mx-4 flex justify-between">
            <div id="modifierContainer" class="flex w-full gap-1"></div>
            <button
              type="button"
              class="inline-flex items-center justify-center h-11 px-4 py-2 whitespace-nowrap rounded-md text-sm font-medium text-slate-200 dark:text-slate-900 ring-offset-white dark:ring-offset-slate-900 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-slate-800 dark:bg-slate-200 hover:bg-slate-800/90 dark:hover:bg-slate-200/90"
              onclick="alert('Coming Soon!')"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="pl-0 mr-2 w-5 h-5"
              >
                <path
                  d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
                />
                <polyline points="14 2 14 8 20 8" />
                <path d="M12 18v-6" />
                <path d="m9 15 3 3 3-3" />
              </svg>
              Export Rule
            </button>
          </div>
        </header>
      </div>

      <iframe
        name="resultIframe"
        id="resultIframe"
        class="mt-48 h-[calc(100vh-14.5rem)] w-full overflow-x-hidden overflow-y-auto border-t-2 border-b-2 border-slate-400 dark:border-slate-700"
      ></iframe>

      <footer
        class="fixed bottom-0 inset-x-0 mx-4 h-10 text-center max-w-3xl lg:mx-auto py-2 text-slate-600 dark:text-slate-400"
      >
        <p>
          Code Licensed Under GPL v3.0 |
          <a
            href="https://github.com/everywall/ladder"
            class="hover:text-blue-500 dark:hover:text-blue-500 hover:underline underline-offset-2 transition-colors duration-300"
            >View Source</a
          >
          |
          <a
            href="https://github.com/everywall"
            class="hover:text-blue-500 dark:hover:text-blue-500 hover:underline underline-offset-2 transition-colors duration-300"
            >Everywall</a
          >
        </p>
      </footer>
      <ninja-keys> </ninja-keys>
    </div>
    <script>
      // TODO: add all modifiers into Ninja Keys
      // TODO: reusable modal for value input for modifiers, reuse focus trap code from script.js
      // TODO: write logic in toggleModifier() to handle non-boolean values
      // TODO: Untoggle related items that may be toggled (e.g. should only have one masquerade as bot toggled)
      // TODO: refactor common logic with form.html to script.js
      // TODO: export to yaml

      function closeDropdownOnClickWithinIframe() {
        const iframe = document.getElementById("resultIframe");
        iframe.contentWindow.document.addEventListener(
          "click",
          () => {
            if (
              !document
                .getElementById("dropdown_panel")
                .classList.contains("hidden")
            ) {
              toggleDropdown();
            }
          },
          true
        );
      }
      closeDropdownOnClickWithinIframe();

      function clearInput() {
        inputField.value = "";
        clearButton.style.display = "none";
        inputField.focus();
      }

      document
        .getElementById("inputForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          submitForm();
        });

      if (navigator.platform.includes("Mac")) {
        document.getElementById("ninjaKey").innerHTML = "⌘";
      } else {
        document.getElementById("ninjaKey").innerHTML = "Ctrl";
      }

      const inputField = document.getElementById("inputField");
      const clearButton = document.getElementById("clearButton");
      const modifierContainer = document.getElementById("modifierContainer");

      if (inputField !== null && clearButton !== null) {
        inputField.addEventListener("input", () => {
          const clearButton = document.getElementById("clearButton");
          if (clearButton !== null) {
            if (inputField.value.trim().length > 0) {
              clearButton.style.display = "block";
            } else {
              clearButton.style.display = "none";
            }
          }
        });

        inputField.addEventListener("keydown", (event) => {
          if (event.code === "Escape") {
            clearInput();
          }
        });

        clearButton.addEventListener("click", () => {
          clearInput();
        });
      }

      function submitForm() {
        if (!document.getElementById("inputForm").checkValidity()) {
          return;
        }
        fetch("/playground/" + inputField.value, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        })
          .then((response) => response.text())
          .then((result) => {
            const resultIframe = parent.document.getElementById("resultIframe");
            resultIframe.contentDocument.open();
            resultIframe.contentDocument.write(result);
            closeDropdownOnClickWithinIframe();
            resultIframe.contentDocument.close();
          });
      }

      function clickHandler(pill) {
        toggleModifier("", pill.id);
        pill.removeEventListener("click", () => clickHandler(pill));
        pill.remove();
      }

      function toggleModifier(modifierType, modifierKey, values) {
        if (modifierType === "") {
          for (const key of Object.keys(payload)) {
            if (key === modifierKey) {
              modifierType = key;
            }
          }
        }
        if (typeof modifierType[modifierKey] === "boolean") {
          modifierType[modifierKey] = !modifierType[modifierKey];
        }

        if (typeof modifierType[modifierKey] === "object") {
          if (modifierType[modifierKey].length > 0) {
            modifierType[modifierKey][0] = "";
          } else {
            // TODO: handle multiple values
            modifierType[modifierKey][0] = values;
          }
        }
        console.log(payload);

        const existingPill = document.getElementById(modifierKey);
        if (!existingPill) {
          const pill = document.createElement("span");
          pill.classList.add(
            "inline-flex",
            "items-center",
            "rounded-md",
            "bg-slate-100",
            "dark:bg-slate-800",
            "px-2",
            "py-1",
            "h-4",
            "text-xs",
            "font-medium",
            "border",
            "border-slate-400",
            "dark:border-slate-700",
            "cursor-pointer"
          );
          pill.id = modifierKey;
          pill.textContent = modifierKey;
          modifierContainer.appendChild(pill);
          pill.addEventListener("click", () => clickHandler(pill));
        } else {
          existingPill.removeEventListener("click", () => clickHandler(pill));
          existingPill.remove();
        }

        submitForm();
      }

      const ninja = document.querySelector("ninja-keys");
      ninja.data = [
        {
          // REQUEST MODIFIERS
          id: "forwardRequestHeaders",
          title: "Forward request headers",
          section: "Request Modifiers",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "forwardrequestheaders"
            );
          },
        },
        {
          id: "masqueradeAsTrustedBot",
          title: "Masquerade as ...",
          children: [
            "Google Bot",
            "Bing Bot",
            "Wayback Machine Bot",
            "Facebook Bot",
            "Yandex Bot",
            "Baidu Bot",
            "DuckDuckGo Bot",
            "Yahoo Bot",
          ],
          section: "Request Modifiers",
          handler: () => {
            ninja.open({ parent: "masqueradeAsTrustedBot" });
            return { keepOpen: true };
          },
        },
        {
          id: "masqueradeAsGoogleBot",
          title: "Google Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "masqueradeasgooglebot"
            );
          },
        },
        {
          id: "masqueradeAsBingBot",
          title: "Bing Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(payload.requestmodifierquery, "masqueradeasbingbot");
          },
        },
        {
          id: "masqueradeAsWaybackMachineBot",
          title: "Wayback Machine Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "masqueradeaswaybackmachinebot"
            );
          },
        },
        {
          id: "masqueradeAsFacebookBot",
          title: "Facebook Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "masqueradeasfacebookbot"
            );
          },
        },
        {
          id: "masqueradeAsYandexBot",
          title: "Yandex Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "masqueradeasyandexbot"
            );
          },
        },
        {
          id: "masqueradeAsBaiduBot",
          title: "Baidu Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(payload.requestmodifierquery, "masqueradeabaidubot");
          },
        },
        {
          id: "masqueradeAsDuckDuckBot",
          title: "DuckDuckGo Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "masqueradeasduckduckbot"
            );
          },
        },
        {
          id: "masqueradeAsYahooBot",
          title: "Yahoo Bot",
          parent: "masqueradeAsTrustedBot",
          section: "Masquerade as ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "masqueradeasyahoobot"
            );
          },
        },
        {
          id: "modifyOutgoingCookies",
          title: "Modify outgoing cookies...",
          children: [
            "Set outgoing cookie",
            "Set outgoing cookies",
            "Delete outgoing cookie",
            "Delete outgoing cookies",
            "Delete outgoing cookies except",
          ],
          section: "Request Modifiers",
          handler: () => {
            ninja.open({ parent: "modifyOutgoingCookies" });
            return { keepOpen: true };
          },
        },
        {
          id: "setOutgoingCookie",
          title: "Set outgoing cookie",
          parent: "modifyOutgoingCookies",
          section: "Modify outgoing cookies ...",
          handler: () => {
            const values = getValues("name", "val");
            toggleModifier(
              payload.requestmodifierquery,
              "setoutgoingcookie",
              values
            );
          },
        },
        {
          id: "setOutgoingCookies",
          title: "Set outgoing cookies",
          parent: "modifyOutgoingCookies",
          section: "Modify outgoing cookies ...",
          handler: () => {
            const values = getValues("cookies");
            toggleModifier(
              payload.requestmodifierquery,
              "setoutgoingcookies",
              values
            );
          },
        },
        {
          id: "deleteOutgoingCookie",
          title: "Delete outgoing cookie",
          parent: "modifyOutgoingCookies",
          section: "Modify outgoing cookies ...",
          handler: () => {
            const values = getValues("name");
            toggleModifier(
              payload.requestmodifierquery,
              "deleteoutgoingcookie",
              values
            );
          },
        },
        {
          id: "deleteOutgoingCookies",
          title: "Delete outgoing cookies",
          parent: "modifyOutgoingCookies",
          section: "Modify outgoing cookies ...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "deleteoutgoingcookies"
            );
          },
        },
        {
          id: "deleteOutgoingCookiesExcept",
          title: "Delete outgoing cookies except",
          parent: "modifyOutgoingCookies",
          section: "Modify outgoing cookies ...",
          handler: () => {
            const values = getValues("whitelist");
            toggleModifier(
              payload.requestmodifierquery,
              "deleteoutgoingcookiesexcept",
              values
            );
          },
        },
        {
          id: "modifyUrl",
          title: "Modify URL...",
          children: [
            "Modify domain with regex",
            "Modify path with regex",
            "Modify query params",
          ],
          section: "Request Modifiers",
          handler: () => {
            ninja.open({ parent: "modifyUrl" });
            return { keepOpen: true };
          },
        },
        {
          id: "modifyDomainWithRegex",
          title: "Modify domain with regex",
          parent: "modifyUrl",
          section: "Modify URL ...",
          handler: () => {
            const values = getValues("match", "replacement"); // TODO write a function to get values
            toggleModifier(
              payload.requestmodifierquery,
              "modifydomainwithregex",
              values
            );
          },
        },
        {
          id: "modifyPathWithRegex",
          title: "Modify path with regex",
          parent: "modifyUrl",
          section: "Modify URL ...",
          handler: () => {
            const values = getValues("match", "replacement");
            toggleModifier(
              payload.requestmodifierquery,
              "modifypathwithregex",
              values
            );
          },
        },
        {
          id: "modifyQueryParams",
          title: "Modify query params",
          parent: "modifyUrl",
          section: "Modify URL ...",
          handler: () => {
            const values = getValues("key", "value");
            toggleModifier(
              payload.requestmodifierquery,
              "modifyqueryparams",
              values
            );
          },
        },
        {
          id: "modifyRequestHeaders",
          title: "Modify request headers...",
          children: ["Set request header", "Delete request header"],
          section: "Request Modifiers",
          handler: () => {
            ninja.open({ parent: "modifyRequestHeaders" });
            return { keepOpen: true };
          },
        },
        {
          id: "setRequestHeader",
          title: "Set request header",
          parent: "modifyRequestHeaders",
          section: "Modify request headers ...",
          handler: () => {
            const values = getValues("name", "val");
            toggleModifier(
              payload.requestmodifierquery,
              "setrequestheader",
              values
            );
          },
        },
        {
          id: "deleteRequestHeader",
          title: "Delete request header",
          parent: "modifyRequestHeaders",
          section: "Modify request headers ...",
          handler: () => {
            const values = getValues("name");
            toggleModifier(
              payload.requestmodifierquery,
              "deleterequestheader",
              values
            );
          },
        },
        {
          id: "requestArchived",
          title: "Request archived version from...",
          children: ["Archive.is", "Google Cache", "Wayback Machine"],
          section: "Request Modifiers",
          handler: () => {
            ninja.open({ parent: "requestArchived" });
            return { keepOpen: true };
          },
        },
        {
          id: "requestArchiveIs",
          title: "Achive.is",
          parent: "requestArchived",
          section: "Reqest archived version from...",
          handler: () => {
            toggleModifier(payload.requestmodifierquery, "requestarchiveis");
          },
        },
        {
          id: "requestGoogleCache",
          title: "Google Cache",
          parent: "requestArchived",
          section: "Reqest archived version from...",
          handler: () => {
            toggleModifier(payload.requestmodifierquery, "requestgooglecache");
          },
        },
        {
          id: "requestWaybackMachine",
          title: "Wayback Machine",
          parent: "requestArchived",
          section: "Reqest archived version from...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "requestwaybackmachine"
            );
          },
        },
        {
          id: "resolveWithGoogleDoH",
          title: "Resolve with Google's DNS over HTTPs service",
          section: "Request Modifiers",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "resolvewithgoogledoh"
            );
          },
        },
        {
          id: "spoofRequest",
          title: "Spoof or hide...",
          children: ["Archive.is", "Google Cache", "Wayback Machine"],
          section: "Request Modifiers",
          handler: () => {
            ninja.open({ parent: "spoofRequest" });
            return { keepOpen: true };
          },
        },
        {
          id: "spoofOrigin",
          title: "Spoof origin",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            const values = getValues("url");
            toggleModifier(payload.requestmodifierquery, "spooforigin", values);
          },
        },
        {
          id: "hideOrigin",
          title: "Hide origin",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(payload.requestmodifierquery, "hideorigin");
          },
        },
        {
          id: "spoofReferrer",
          title: "Spoof referrer",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            const values = getValues("url");
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrer",
              values
            );
          },
        },
        {
          id: "hideReferrer",
          title: "Hide referrer",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(payload.requestmodifierquery, "hidereferrer");
          },
        },
        {
          id: "spoofReferrerFromBaiduSearch",
          title: "Spoof referrer from Baidu search",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfrombaidusearch"
            );
          },
        },
        {
          id: "spoofReferrerFromBingSearch",
          title: "Spoof referrer from Bing search",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfrombingsearch"
            );
          },
        },
        {
          id: "spoofReferrerFromGoogleSearch",
          title: "Spoof referrer from Google search",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromgooglesearch"
            );
          },
        },
        {
          id: "spoofReferrerFromLinkedinPost",
          title: "Spoof referrer from Linkedin post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromlinkedinpost"
            );
          },
        },
        {
          id: "spoofReferrerFromNaverSearch",
          title: "Spoof referrer from Naver search",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromnaversearch"
            );
          },
        },
        {
          id: "spoofReferrerFromPinterestPost",
          title: "Spoof referrer from Pinterest post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfrompinterestpost"
            );
          },
        },
        {
          id: "spoofReferrerFromQQPost",
          title: "Spoof referrer from QQ post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromqqpost"
            );
          },
        },
        {
          id: "spoofReferrerFromRedditPost",
          title: "Spoof referrer from Reddit post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromredditpost"
            );
          },
        },
        {
          id: "spoofReferrerFromTumblrPost",
          title: "Spoof referrer from Tumblr post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromtumblrpost"
            );
          },
        },
        {
          id: "spoofReferrerFromTwitterPost",
          title: "Spoof referrer from Twitter post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromtwitterpost"
            );
          },
        },
        {
          id: "spoofReferrerFromKontaktePost",
          title: "Spoof referrer from Kontakte post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromkontaktelepost"
            );
          },
        },
        {
          id: "spoofReferrerFromWeiboPost",
          title: "Spoof referrer from Weibo post",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            toggleModifier(
              payload.requestmodifierquery,
              "spoofreferrerfromweibopost"
            );
          },
        },
        {
          id: "spoofUserAgent",
          title: "Spoof user agent",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            const values = getValues("ua");
            toggleModifier(
              payload.requestmodifierquery,
              "spoofuseragent",
              values
            );
          },
        },
        {
          id: "spoofXForwardedFor",
          title: "Spoof X-Forwarded-For",
          parent: "spoofRequest",
          section: "Spoof or hide...",
          handler: () => {
            const values = getValues("ip");
            toggleModifier(
              payload.requestmodifierquery,
              "spoofxforwardedfor",
              values
            );
          },
        },
        // RESPONSE MODIFIERS
        {
          id: "GenerateReadableOutline",
          title: "Generate readable outline",
          section: "Response Modifiers",
          handler: () => {
            toggleModifier(
              payload.responsemodifierquery,
              "generatereadableoutline"
            );
          },
        },
      ];
      document.getElementById("btnNinja").addEventListener("click", () => {
        ninja.open();
      });

      let payload = {
        requestmodifierquery: {
          forwardrequestheaders: false,
          masqueradeasgooglebot: false,
          masqueradeasbingbot: false,
          masqueradeaswaybackmachinebot: false,
          masqueradeasfacebookbot: false,
          masqueradeasyandexbot: false,
          masqueradeasbaidubot: false,
          masqueradeasduckduckbot: false,
          masqueradeasyahoobot: false,
          modifydomainwithregex: {
            match: "",
            replacement: "",
          },
          setoutgoingcookie: {
            name: "",
            val: "",
          },
          setoutgoingcookies: {
            cookies: "",
          },
          deleteoutgoingcookie: {
            name: "",
          },
          deleteoutgoingcookies: false,
          deleteoutgoingcookiesexcept: {
            whitelist: "",
          },
          modifypathwithregex: {
            match: "",
            replacement: "",
          },
          modifyqueryparams: {
            key: "",
            value: "",
          },
          setrequestheader: {
            name: "",
            val: "",
          },
          deleterequestheader: {
            name: "",
          },
          requestarchiveis: false,
          requestgooglecache: false,
          requestwaybackmachine: false,
          resolvewithgoogledoh: false,
          spooforigin: {
            url: "",
          },
          hideorigin: false,
          spoofreferrer: {
            url: "",
          },
          hidereferrer: false,
          spoofreferrerfrombaidusearch: false,
          spoofreferrerfrombingsearch: false,
          spoofreferrerfromgooglesearch: false,
          spoofreferrerfromlinkedinpost: false,
          spoofreferrerfromnaversearch: false,
          spoofreferrerfrompinterestpost: false,
          spoofreferrerfromqqpost: false,
          spoofreferrerfromredditpost: false,
          spoofreferrerfromtumblrpost: false,
          spoofreferrerfromtwitterpost: false,
          spoofreferrerfromvkontaktepost: false,
          spoofreferrerfromweibopost: false,
          spoofuseragent: {
            ua: "",
          },
          spoofxforwardedfor: {
            ip: "",
          },
        },
        responsemodifierquery: {
          apicontent: false,
          blockelementremoval: {
            cssSelector: "",
          },
          bypasscors: false,
          bypasscontentsecuritypolicy: false,
          setcontentsecuritypolicy: {
            csp: "",
          },
          forwardresponseheaders: false,
          generatereadableoutline: false,
          injectscriptbeforedomcontentloaded: {
            js: "",
          },
          injectscriptafterdomcontentloaded: {
            js: "",
          },
          injectscriptafterdomidle: {
            js: "",
          },
          deleteincomingcookies: false,
          deleteincomingcookiesexcept: {
            whitelist: "",
          },
          setincomingcookies: {
            cookies: "",
          },
          setincomingcookie: {
            name: "",
            val: "",
          },
          setresponseheader: {
            key: "",
            value: "",
          },
          deleteresponseheader: {
            key: "",
          },
          patchdynamicresourceurls: false,
          patchgoogleanalytics: false,
          patchtrackerscripts: false,
          rewritehtmlresourceurls: false,
        },
      };
    </script>
  </body>
</html>
